import z from"./App-50a3e37c.js";import{r as y,T as A,s as P,o as p,f as M,g as o,a as e,c as v,t,h as b,k as R,j as a,u as c,n as L,Q as Z,N as U,w as E,v as q,b as V,d as H,F as D,e as I,l as Q,i as G}from"./app-3e8877e3.js";import{d as J}from"./debounce-935eb07c.js";import{_ as K}from"./AlertModal-e70349eb.js";import{u as W}from"./useAlertModal-3b50b88b.js";import{_ as X}from"./Modal-94522b20.js";import{F as Y}from"./FormSelect-707ebb8d.js";/* empty css              */import{_ as ee}from"./Table-2d5b5408.js";import{T as te,a as se,_ as $}from"./TableHeaderRowItem-d1249a2e.js";import{T as ae,a as oe,_ as x}from"./TableBodyRowItem-0c253a8e.js";import{_ as ne}from"./Dropdown-063ecb50.js";import{_ as re,a as F}from"./DropdownItem-8d0f375d.js";import"./useRtl-5c9a48fc.js";import"./index-b92cfe8e.js";import"./MobileSidebar-839d7225.js";import"./FormInput-7ef34c59.js";import"./ProfileModal-38da4bd8.js";import"./FormPhoneInput-0afe4c41.js";import"./transition-18330a8a.js";import"./keyboard-49b00fa1.js";import"./use-text-value-db86cb19.js";import"./Sidebar-3d5cedaa.js";import"./Menu-ee94a4df.js";import"./_baseGetTag-9b465718.js";import"./Pagination-f1e6d96c.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-tree-walker-53e04018.js";const le={class:"mt-5"},ie={key:0,class:"flex justify-center items-center py-8"},de={key:1},ue={class:"mb-4 p-2 bg-yellow-50 border border-yellow-200 rounded-md"},ce={class:"flex"},me={class:"ml-3"},pe={class:"text-sm font-medium text-yellow-800"},fe={class:"mt-2 text-sm text-yellow-700"},be={class:"mb-4"},he={class:"text-sm font-medium text-gray-900 mb-2"},ge={class:"p-3 bg-gray-50 rounded-md"},ve={class:"font-medium"},_e={class:"text-sm text-gray-600"},we={class:"mb-4"},ye={class:"block text-sm font-medium text-gray-700 mb-2"},$e={class:"flex justify-end space-x-3"},xe=["disabled"],ke={key:0},Ce={key:1},Te={key:2},Se={class:"text-center py-8"},je={class:"text-lg font-medium text-gray-900 mb-2"},Ne={class:"text-gray-600 mb-4"},Be={class:"flex justify-center space-x-3"},Me=["disabled"],Oe={__name:"PlanTransferModal",props:{isOpen:{type:Boolean,default:!1},planUuid:{type:String,default:null}},emits:["close","deleted"],setup(_,{emit:k}){const i=_,h=k,C=y(!1),g=y({has_subscribers:!1}),u=A({transfer_to_plan:null}),w=y([]),T=()=>{var m;const l=(m=Z().props.config)==null?void 0:m.find(j=>j.key==="currency");return(l==null?void 0:l.value)||"$"},S=async()=>{if(i.planUuid){C.value=!0;try{const l=await(await fetch(`/admin/plans/${i.planUuid}/check-subscribers`)).json();g.value=l,l.has_subscribers&&l.available_plans&&(w.value=l.available_plans.map(m=>({value:m.uuid,label:`${m.name} - ${T()}${m.price}/${m.period}`})))}catch(s){console.error("Error checking subscribers:",s)}finally{C.value=!1}}},N=()=>{u.transfer_to_plan&&u.post(`/admin/plans/${i.planUuid}/destroy-with-transfer`,{onSuccess:()=>{h("deleted"),f()}})},B=()=>{u.delete(`/admin/plans/${i.planUuid}`,{onSuccess:()=>{h("deleted"),f()}})},f=()=>{h("close"),u.reset(),g.value={has_subscribers:!1},w.value=[]};return P(()=>i.planUuid,s=>{s&&i.isOpen&&S()}),P(()=>i.isOpen,s=>{s&&i.planUuid&&S()}),(s,l)=>(p(),M(X,{label:s.$t("Transfer Subscribers"),isOpen:_.isOpen,onClose:f},{default:o(()=>[e("div",le,[C.value?(p(),v("div",ie,[...l[1]||(l[1]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"},null,-1)])])):g.value.has_subscribers?(p(),v("div",de,[e("div",ue,[e("div",ce,[e("div",me,[e("h3",pe,t(s.$t("Subscribers Found")),1),e("div",fe,[e("p",null,[b(t(s.$t("This plan has"))+" ",1),e("strong",null,t(g.value.subscriber_count),1),b(" "+t(s.$t("subscribers"))+". "+t(s.$t("Please select a plan to transfer them to before deleting this plan"))+".",1)])])])])]),e("div",be,[e("h4",he,t(s.$t("Current Plan"))+":",1),e("div",ge,[e("div",ve,t(g.value.plan.name),1),e("div",_e,t(T())+t(g.value.plan.price)+" / "+t(g.value.plan.period),1)])]),e("form",{onSubmit:R(N,["prevent"])},[e("div",we,[e("label",ye,t(s.$t("Transfer subscribers to"))+": ",1),a(Y,{modelValue:c(u).transfer_to_plan,"onUpdate:modelValue":l[0]||(l[0]=m=>c(u).transfer_to_plan=m),name:s.$t("Select Plan"),error:c(u).errors.transfer_to_plan,options:w.value,class:L("w-full"),dropdownUp:!0,required:""},null,8,["modelValue","name","error","options"])]),e("div",$e,[e("button",{type:"button",onClick:f,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},t(s.$t("Cancel")),1),e("button",{type:"submit",disabled:c(u).processing||!c(u).transfer_to_plan,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"},[c(u).processing?(p(),v("span",ke,t(s.$t("Transferring...")),1)):(p(),v("span",Ce,t(s.$t("Transfer & Delete Plan")),1))],8,xe)])],32)])):(p(),v("div",Te,[e("div",Se,[l[2]||(l[2]=e("div",{class:"text-green-600 mb-2"},[e("svg",{class:"mx-auto h-12 w-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e("h3",je,t(s.$t("No Subscribers")),1),e("p",Ne,t(s.$t("This plan has no subscribers and can be safely deleted"))+".",1),e("div",Be,[e("button",{type:"button",onClick:f,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},t(s.$t("Cancel")),1),e("button",{onClick:B,disabled:c(u).processing,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50"},t(s.$t("Delete Plan")),9,Me)])])]))])]),_:1},8,["label","isOpen"]))}},Pe={class:"md:bg-white flex items-center border border-primary md:border-none md:shadow-sm h-12 md:h-10 w-full md:w-80 rounded-[0.5rem] mb-6 text-xl md:text-sm"},Ue=["placeholder"],Ve={key:1,class:"pr-2"},De={class:"float-right"},Fe={class:"float-right"},Ae={class:"py-1 float-right rounded-[5px] text-xs px-3 bg-[#ddebf7] text-slate-700"},Le={class:"float-right"},ze={__name:"SubscriptionPlanTable",props:{rows:{type:Object,required:!0},filters:{type:Object}},emits:["delete"],setup(_,{emit:k}){const i=_,{isOpenAlert:h,openAlert:C,confirmAlert:g}=W(),u=A({test:null}),w=y(!1),T=y(null),S=async r=>{T.value=r;try{(await(await fetch(`/admin/plans/${r}/check-subscribers`)).json()).has_subscribers?w.value=!0:u.delete("/admin/plans/"+r)}catch(n){console.error("Error checking subscribers:",n),u.delete("/admin/plans/"+r)}},N=()=>{U.reload()},B=r=>r===i.rows.data.length-1,f=y({search:i.filters.search}),s=y(!1),l=()=>{f.value.search=null,j()},m=J(()=>{s.value=!0,j()},1e3),j=()=>{U.visit("/admin/plans",{method:"get",data:f.value})};return(r,n)=>(p(),v(D,null,[e("div",Pe,[n[7]||(n[7]=e("span",{class:"pl-3"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m15 15l6 6m-11-4a7 7 0 1 1 0-14a7 7 0 0 1 0 14Z"})])],-1)),E(e("input",{onInput:n[0]||(n[0]=(...d)=>c(m)&&c(m)(...d)),"onUpdate:modelValue":n[1]||(n[1]=d=>f.value.search=d),type:"text",class:"outline-none px-4 w-full",placeholder:r.$t("Search plans")},null,40,Ue),[[q,f.value.search]]),s.value===!1&&f.value.search?(p(),v("button",{key:0,onClick:l,type:"button",class:"pr-2"},[...n[5]||(n[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10s10-4.5 10-10S17.5 2 12 2zm3.7 12.3c.4.4.4 1 0 1.4c-.4.4-1 .4-1.4 0L12 13.4l-2.3 2.3c-.4.4-1 .4-1.4 0c-.4-.4-.4-1 0-1.4l2.3-2.3l-2.3-2.3c-.4-.4-.4-1 0-1.4c.4-.4 1-.4 1.4 0l2.3 2.3l2.3-2.3c.4-.4 1-.4 1.4 0c.4.4.4 1 0 1.4L13.4 12l2.3 2.3z"})],-1)])])):V("",!0),s.value?(p(),v("span",Ve,[...n[6]||(n[6]=[H('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="0 12 12;90 12 12;180 12 12;270 12 12"></animateTransform><animate attributeName="opacity" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.2s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="30 12 12;120 12 12;210 12 12;300 12 12"></animateTransform><animate attributeName="opacity" begin="0.2s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle><circle cx="12" cy="3.5" r="1.5" fill="currentColor" opacity="0"><animateTransform attributeName="transform" begin="0.4s" calcMode="discrete" dur="2.4s" repeatCount="indefinite" type="rotate" values="60 12 12;150 12 12;240 12 12;330 12 12"></animateTransform><animate attributeName="opacity" begin="0.4s" dur="0.6s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1;1;0"></animate></circle></svg>',1)])])):V("",!0)]),a(ee,{rows:_.rows},{default:o(()=>[a(te,null,{default:o(()=>[a(se,null,{default:o(()=>[a($,{position:"first"},{default:o(()=>[b(t(r.$t("Name")),1)]),_:1}),a($,{class:"hidden sm:table-cell"},{default:o(()=>[b(t(r.$t("Price")),1)]),_:1}),a($,{class:"hidden sm:table-cell"},{default:o(()=>[b(t(r.$t("Period")),1)]),_:1}),a($,null,{default:o(()=>[e("span",De,t(r.$t("Status")),1)]),_:1}),a($,{class:"hidden sm:table-cell"},{default:o(()=>[e("span",Fe,t(r.$t("Last updated")),1)]),_:1}),a($,{position:"last"})]),_:1})]),_:1}),a(ae,null,{default:o(()=>[(p(!0),v(D,null,I(_.rows.data,(d,O)=>(p(),M(oe,{key:O,class:L(B(O)?"":"border-b")},{default:o(()=>[a(x,{position:"first",class:"capitalize"},{default:o(()=>[b(t(d.name),1)]),_:2},1024),a(x,{class:"hidden sm:table-cell"},{default:o(()=>[b(t(d.price),1)]),_:2},1024),a(x,{class:"hidden sm:table-cell"},{default:o(()=>[b(t(r.$t(d.period)),1)]),_:2},1024),a(x,{class:"capitalize"},{default:o(()=>[e("span",Ae,t(r.$t(d.status)),1)]),_:2},1024),a(x,{class:"hidden sm:table-cell"},{default:o(()=>[e("span",Le,t(d.updated_at),1)]),_:2},1024),a(x,{position:"last"},{default:o(()=>[a(ne,{align:"right",class:"mt-2"},{items:o(()=>[a(re,null,{default:o(()=>[a(F,{href:"/admin/plans/"+d.uuid},{default:o(()=>[b(t(r.$t("View/edit")),1)]),_:1},8,["href"]),a(F,{as:"button",onClick:Ie=>c(C)(d.uuid)},{default:o(()=>[b(t(r.$t("Delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:o(()=>[n[8]||(n[8]=e("button",{class:"inline-flex w-full justify-center rounded-md text-sm font-medium text-black hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-opacity-75"},[e("span",{class:"hover:bg-[#F6F7F9] hover:rounded-full w-[fit-content] p-2"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 16a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2m0-6a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2m0-6a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2Z"})])])],-1))]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1},8,["rows"]),a(K,{modelValue:c(h),"onUpdate:modelValue":n[2]||(n[2]=d=>Q(h)?h.value=d:null),onConfirm:n[3]||(n[3]=()=>c(g)(S)),label:r.$t("Delete Plan"),description:r.$t("Are you sure you want to delete this plan? This action cannot be undone")},null,8,["modelValue","label","description"]),a(Oe,{isOpen:w.value,planUuid:T.value,onClose:n[4]||(n[4]=d=>w.value=!1),onDeleted:N},null,8,["isOpen","planUuid"])],64))}},Re={class:"bg-white md:bg-inherit pt-10 px-4 md:pt-8 md:p-8 rounded-[5px] text-[#000] h-full md:overflow-y-auto"},Ze={class:"flex justify-between"},Ee={class:"text-xl mb-1"},qe={class:"mb-6 flex items-center text-sm leading-6 text-gray-600"},He={class:"ml-1 mt-1"},yt={__name:"Index",props:{allowCreate:{type:Boolean,default:!0},title:String,rows:Object,filters:Object},setup(_){const k=_;return(i,h)=>(p(),M(z,null,{default:o(()=>[e("div",Re,[e("div",Ze,[e("div",null,[e("h1",Ee,t(i.$t("Subscription plans")),1),e("p",qe,[h[0]||(h[0]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 11v5m0 5a9 9 0 1 1 0-18a9 9 0 0 1 0 18Zm.05-13v.1h-.1V8h.1Z"})],-1)),e("span",He,t(i.$t("Manage subscription plans")),1)])]),e("div",null,[a(c(G),{href:"/admin/plans/create",class:"rounded-md bg-indigo-600 px-3 py-2 text-sm text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"},{default:o(()=>[b(t(i.$t("Create plan")),1)]),_:1})])]),a(ze,{rows:k.rows,filters:k.filters},null,8,["rows","filters"])])]),_:1}))}};export{yt as default};
