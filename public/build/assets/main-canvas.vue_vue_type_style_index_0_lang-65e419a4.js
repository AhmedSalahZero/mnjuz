import{u as G,P as se,_ as ie,C as le,a as re}from"./vue-flow-core-4dce5b31.js";import{E as Z,m as de,a6 as L,o as s,c as p,J as u,a as $,u as c,f as m,b as y,z as ce,I as q,g as H,F as ue,j as D,a0 as x,V as J,r as fe,a7 as b,p as pe,s as W,H as ve}from"./app-3e8877e3.js";import{_ as he}from"./Start-node.vue_vue_type_script_setup_true_lang-a12ae1c7.js";import me from"./Buttons-node-22ab8f17.js";import _e from"./List-node-a31ecdc8.js";import{_ as ge}from"./Media-node.vue_vue_type_script_setup_true_lang-0f761d71.js";import{_ as we}from"./Text-node.vue_vue_type_script_setup_true_lang-b57970c4.js";import ye from"./Action-node-8f595b2b.js";var _=(e=>(e.Lines="lines",e.Dots="dots",e))(_||{});const K=function({dimensions:e,size:n,color:a}){return q("path",{stroke:a,"stroke-width":n,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`})},Q=function({radius:e,color:n}){return q("circle",{cx:e,cy:e,r:e,fill:n})};_.Lines+"",_.Dots+"";const $e={[_.Dots]:"#81818a",[_.Lines]:"#eee"},ze=["id","x","y","width","height","patternTransform"],Ce={key:2,height:"100",width:"100"},ke=["fill"],Ve=["x","y","fill"],be={name:"Background",compatConfig:{MODE:3}},He=Z({...be,props:{id:{},variant:{default:()=>_.Dots},gap:{default:20},size:{default:1},lineWidth:{default:1},patternColor:{},color:{},bgColor:{},height:{default:100},width:{default:100},x:{default:0},y:{default:0},offset:{default:0}},setup(e){const{id:n,viewport:a}=G(),r=de(()=>{const t=a.value.zoom,[h,M]=Array.isArray(e.gap)?e.gap:[e.gap,e.gap],g=[h*t||1,M*t||1],z=e.size*t,[B,w]=Array.isArray(e.offset)?e.offset:[e.offset,e.offset],I=[B*t||1+g[0]/2,w*t||1+g[1]/2];return{scaledGap:g,offset:I,size:z}}),f=L(()=>`pattern-${n}${e.id?`-${e.id}`:""}`),v=L(()=>e.color||e.patternColor||$e[e.variant||_.Dots]);return(t,h)=>(s(),p("svg",{class:"vue-flow__background vue-flow__container",style:ce({height:`${t.height>100?100:t.height}%`,width:`${t.width>100?100:t.width}%`})},[u(t.$slots,"pattern-container",{id:f.value},()=>[$("pattern",{id:f.value,x:c(a).x%r.value.scaledGap[0],y:c(a).y%r.value.scaledGap[1],width:r.value.scaledGap[0],height:r.value.scaledGap[1],patternTransform:`translate(-${r.value.offset[0]},-${r.value.offset[1]})`,patternUnits:"userSpaceOnUse"},[u(t.$slots,"pattern",{},()=>[t.variant===c(_).Lines?(s(),m(c(K),{key:0,size:t.lineWidth,color:v.value,dimensions:r.value.scaledGap},null,8,["size","color","dimensions"])):t.variant===c(_).Dots?(s(),m(c(Q),{key:1,color:v.value,radius:r.value.size/2},null,8,["color","radius"])):y("",!0),t.bgColor?(s(),p("svg",Ce,[$("rect",{width:"100%",height:"100%",fill:t.bgColor},null,8,ke)])):y("",!0)])],8,ze)]),$("rect",{x:t.x,y:t.y,width:"100%",height:"100%",fill:`url(#${f.value})`},null,8,Ve),u(t.$slots,"default",{id:f.value})],4))}}),De={name:"ControlButton",compatConfig:{MODE:3}},Me=(e,n)=>{const a=e.__vccOpts||e;for(const[r,f]of n)a[r]=f;return a},Be={type:"button",class:"vue-flow__controls-button"};function Ie(e,n,a,r,f,v){return s(),p("button",Be,[u(e.$slots,"default")])}const T=Me(De,[["render",Ie]]),Ne={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},Oe=$("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"},null,-1),xe=[Oe];function Le(e,n){return s(),p("svg",Ne,xe)}const Se={render:Le},Fe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5"},Pe=$("path",{d:"M0 0h32v4.2H0z"},null,-1),Te=[Pe];function Ae(e,n){return s(),p("svg",Fe,Te)}const Ee={render:Ae},Ge={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30"},Ze=$("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0 0 27.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94a.919.919 0 0 1-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"},null,-1),Re=[Ze];function Xe(e,n){return s(),p("svg",Ge,Re)}const Ye={render:Xe},je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Ue=$("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"},null,-1),Je=[Ue];function We(e,n){return s(),p("svg",je,Je)}const qe={render:We},Ke={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32"},Qe=$("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 0 0 0 13.714v15.238A3.056 3.056 0 0 0 3.048 32h18.285a3.056 3.056 0 0 0 3.048-3.048V13.714a3.056 3.056 0 0 0-3.048-3.047zM12.19 24.533a3.056 3.056 0 0 1-3.047-3.047 3.056 3.056 0 0 1 3.047-3.048 3.056 3.056 0 0 1 3.048 3.048 3.056 3.056 0 0 1-3.048 3.047z"},null,-1),et=[Qe];function tt(e,n){return s(),p("svg",Ke,et)}const ot={render:tt},nt={name:"Controls",compatConfig:{MODE:3}},at=Z({...nt,props:{showZoom:{type:Boolean,default:!0},showFitView:{type:Boolean,default:!0},showInteractive:{type:Boolean,default:!0},fitViewParams:{},position:{default:()=>se.BottomLeft}},emits:["zoomIn","zoomOut","fitView","interactionChange"],setup(e,{emit:n}){const{nodesDraggable:a,nodesConnectable:r,elementsSelectable:f,setInteractive:v,zoomIn:t,zoomOut:h,fitView:M,viewport:g,minZoom:z,maxZoom:B}=G(),w=L(()=>a.value||r.value||f.value),I=L(()=>g.value.zoom<=z.value),R=L(()=>g.value.zoom>=B.value);function N(){t(),n("zoomIn")}function O(){h(),n("zoomOut")}function S(){M(e.fitViewParams),n("fitView")}function A(){v(!w.value),n("interactionChange",!w.value)}return(i,X)=>(s(),m(c(ie),{class:"vue-flow__controls",position:i.position},{default:H(()=>[u(i.$slots,"top"),i.showZoom?(s(),p(ue,{key:0},[u(i.$slots,"control-zoom-in",{},()=>[D(T,{class:"vue-flow__controls-zoomin",disabled:R.value,onClick:N},{default:H(()=>[u(i.$slots,"icon-zoom-in",{},()=>[(s(),m(x(c(Se))))])]),_:3},8,["disabled"])]),u(i.$slots,"control-zoom-out",{},()=>[D(T,{class:"vue-flow__controls-zoomout",disabled:I.value,onClick:O},{default:H(()=>[u(i.$slots,"icon-zoom-out",{},()=>[(s(),m(x(c(Ee))))])]),_:3},8,["disabled"])])],64)):y("",!0),i.showFitView?u(i.$slots,"control-fit-view",{key:1},()=>[D(T,{class:"vue-flow__controls-fitview",onClick:S},{default:H(()=>[u(i.$slots,"icon-fit-view",{},()=>[(s(),m(x(c(Ye))))])]),_:3})]):y("",!0),i.showInteractive?u(i.$slots,"control-interactive",{key:2},()=>[i.showInteractive?(s(),m(T,{key:0,class:"vue-flow__controls-interactive",onClick:A},{default:H(()=>[w.value?u(i.$slots,"icon-unlock",{key:0},()=>[(s(),m(x(c(ot))))]):y("",!0),w.value?y("",!0):u(i.$slots,"icon-lock",{key:1},()=>[(s(),m(x(c(qe))))])]),_:3})):y("",!0)]):y("",!0),u(i.$slots,"default")]),_:3},8,["position"]))}}),st={nodes:[{type:"LLM",data:{title:"LLM",output:[{name:"output1",type:"",description:"balabala"}]},events:{},id:"1",position:{x:-413.62574973269915,y:110.25705825948319},label:"LLM node"},{type:"code",data:{title:"code",output:[{name:"key0",type:"String",description:"just for test"}]},events:{},id:"2",position:{x:262.70018202243125,y:-104.44788021583054},label:"code node"},{type:"knowledge",data:{title:"knowledge",output:[{name:"output"}]},events:{},id:"3",position:{x:939.64275630104,y:51.1990333957562},label:"knowledge node"}],edges:[{sourceHandle:"1__handle-right",targetHandle:"2__handle-left",type:"default",source:"1",target:"2",data:{},events:{},id:"vueflow__edge-11__handle-right-22__handle-left",sourceX:200.40522146581822,sourceY:488.25689832215323,targetX:253.70017309626013,targetY:364.55198874414043},{sourceHandle:"2__handle-right",targetHandle:"3__handle-left",type:"default",source:"2",target:"3",data:{},events:{},id:"vueflow__edge-22__handle-right-33__handle-left",sourceX:871.6999267177814,sourceY:364.55198874414043,targetX:930.6427473748689,targetY:342.1989975362437}],position:[-151.90460217317343,183.68497815279642],zoom:.5802807591037111,viewport:{x:-151.90460217317343,y:183.68497815279642,zoom:.5802807591037111}},vt=Z({__name:"main-canvas",props:["uuid","flow","contactGroups","contactFields"],emits:["updateStatus","updatePayload"],setup(e,{emit:n}){const a=e;J("contactGroups",a.contactGroups||[]),J("contactFields",a.contactFields||[]);const r=fe(),f={start:b(he),list:b(_e),buttons:b(me),media:b(ge),text:b(we),action:b(ye)},{findNode:v,nodes:t,edges:h,viewport:M,addNodes:g,addEdges:z,project:B,vueFlowRef:w,onConnect:I,onNodeDragStop:R,setNodes:N,setEdges:O,setViewport:S,onViewportChange:A}=G();pe(()=>{if(a.flow.metadata){const o=JSON.parse(a.flow.metadata);o.nodes&&o.nodes.filter(l=>l.type==="action"),N(o.nodes||[]),O(o.edges||[]),S(o.viewport||[])}else N([{id:"1",type:"start",label:"start",position:{x:25,y:10},data:{uuid:a.uuid,title:"start",metadata:{fields:[]}}}])}),W([t,h],()=>{t.value.filter(l=>l.type==="action").length>0,Y()},{deep:!0}),I(o=>{const l=v(o.source);if(v(o.target),l&&l.type==="start"){z(o);return}if(o.source&&o.target){const C=h.value.filter(k=>k.source===o.source&&k.sourceHandle===o.sourceHandle);if(C.length>0){const k=C.map(V=>V.id);O(h.value.filter(V=>!k.includes(V.id)))}z(o)}else z(o)}),A(()=>{Y()});const i=n,X=o=>{switch(o){case"add_to_group":case"remove_from_group":return{group_id:""};case"update_contact":return{target_field:"",invalid_email_message:"Please provide a valid email address.",fields:{first_name:"",last_name:"",email:"",phone:"",address:{street:"",city:"",state:"",zip:"",country:""},metadata:{}}};case"send_email":return{subject:"",body:"",smtp_host:"",smtp_port:587,smtp_username:"",smtp_password:"",smtp_encryption:"tls",from_name:""};case"delay":return{duration:5};case"webhook":return{url:"",method:"POST"};case"ai_response":return{prompt:"",proceed_condition:"always",confidence_threshold:.8,low_confidence_message:""};case"conditional":return{condition_type:"message_contains",field_name:"",field_operator:"equals",variable_name:"",variable_operator:"equals",conditions:[]};default:return{}}},Y=()=>{i("updatePayload",JSON.stringify({nodes:t.value,edges:h.value,viewport:M.value}))};function ee(o){var U;const l=(U=o.dataTransfer)==null?void 0:U.getData("application/vueflow");if(l==="workflow"){const{nodes:d,edges:E,position:P,zoom:oe}=st,[ne=0,ae=0]=P;N(d),O(E),S({x:ne,y:ae,zoom:oe||0});return}const{left:C,top:k}=w.value.getBoundingClientRect(),V=B({x:o.clientX-C,y:o.clientY-k}),j=t.value.length?Math.max(...t.value.map(d=>parseInt(d.id,10)))+1:1;let F;if(l&&l.startsWith("action-")){const d=l.replace("action-","").replace(/-/g,"_");F={id:(j+1).toString(),type:"action",position:V,label:`${d} action`,data:{uuid:a.uuid,title:d,actionType:d,config:X(d),is_active:!0}}}else F={id:(j+1).toString(),type:l,position:V,label:`${l} node`,data:{uuid:a.uuid,title:l,metadata:{fields:[]}}};g([F]),ve(()=>{const d=v(F.id),E=W(()=>d.dimensions,P=>{P.width>0&&P.height>0&&d&&(d.position={x:d.position.x-d.dimensions.width/2,y:d.position.y-d.dimensions.height/2},E())},{deep:!0,flush:"post"})})}function te(o){o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="move")}return(o,l)=>(s(),p("div",{class:"relative h-full w-full",id:"main-canvas",onDrop:ee,onDragover:te},[D(c(re),{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=C=>r.value=C),"node-types":f,"connection-mode":c(le).Strict},{default:H(()=>[D(c(at)),D(c(He))]),_:1},8,["modelValue","connection-mode"])],32))}});export{vt as _};
